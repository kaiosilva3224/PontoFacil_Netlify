<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PontoFÃ¡cil - Painel Administrativo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .logo {
            text-align: center;
            margin-bottom: 2rem;
            padding: 0 1rem;
        }

        .logo h1 {
            color: #667eea;
            font-size: 1.8rem;
            font-weight: bold;
        }

        .logo p {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin: 0.5rem 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: #555;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border-left-color: #667eea;
        }

        .nav-link i {
            margin-right: 1rem;
            width: 20px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 1.8rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .logout-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #ff3742;
            transform: translateY(-2px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.empresas { background: #667eea; }
        .stat-icon.receita { background: #2ed573; }
        .stat-icon.pendentes { background: #ffa502; }
        .stat-icon.usuarios { background: #5352ed; }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .content-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f1f2f6;
        }

        .section-title {
            font-size: 1.5rem;
            color: #333;
            font-weight: 600;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #2ed573;
        }

        .btn-success:hover {
            background: #26d065;
        }

        .btn-danger {
            background: #ff4757;
        }

        .btn-danger:hover {
            background: #ff3742;
        }

        .search-filter {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-select {
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .table th,
        .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-ativo {
            background: #d4edda;
            color: #155724;
        }

        .status-inativo {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pendente {
            background: #fff3cd;
            color: #856404;
        }

        .status-pago {
            background: #d4edda;
            color: #155724;
        }

        .status-atrasado {
            background: #f8d7da;
            color: #721c24;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.5rem;
            font-size: 0.8rem;
            border-radius: 6px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f1f2f6;
        }

        .modal-title {
            font-size: 1.3rem;
            color: #333;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .alert.active {
            display: block;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-title {
            color: #333;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: #666;
            margin-bottom: 2rem;
        }

        .payment-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1rem;
        }

        .plan-card {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .plan-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .plan-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .plan-price {
            font-size: 1.5rem;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .plan-features {
            list-style: none;
            margin-bottom: 1rem;
        }

        .plan-features li {
            padding: 0.25rem 0;
            color: #666;
        }

        .plan-features li:before {
            content: "â";
            color: #2ed573;
            font-weight: bold;
            margin-right: 0.5rem;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: 1rem 0;
            }

            .nav-menu {
                display: flex;
                overflow-x: auto;
                padding: 0 1rem;
            }

            .nav-item {
                margin: 0 0.5rem;
                white-space: nowrap;
            }

            .main-content {
                padding: 1rem;
            }

            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .search-filter {
                flex-direction: column;
            }

            .search-input {
                min-width: auto;
            }

            .table {
                font-size: 0.8rem;
            }

            .table th,
            .table td {
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="logo">
                <h1>ð PontoFÃ¡cil</h1>
                <p>Painel Administrativo</p>
            </div>
            <h2 class="login-title">Bem-vindo!</h2>
            <p class="login-subtitle">FaÃ§a login para acessar o painel</p>
            
            <div id="loginAlert" class="alert"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email:</label>
                    <input type="email" id="loginEmail" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Senha:</label>
                    <input type="password" id="loginPassword" class="form-input" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i>
                    Entrar
                </button>
            </form>
            
            <div id="loginLoading" class="loading">
                <div class="spinner"></div>
                <p>Fazendo login...</p>
            </div>
        </div>
    </div>

    <!-- Painel Principal -->
    <div id="mainPanel" class="container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1>ð PontoFÃ¡cil</h1>
                <p>Painel Administrativo</p>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="dashboard">
                        <i class="fas fa-chart-line"></i>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="empresas">
                        <i class="fas fa-building"></i>
                        Empresas
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="financeiro">
                        <i class="fas fa-dollar-sign"></i>
                        Financeiro
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="usuarios">
                        <i class="fas fa-users"></i>
                        UsuÃ¡rios
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="relatorios">
                        <i class="fas fa-chart-bar"></i>
                        RelatÃ³rios
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="configuracoes">
                        <i class="fas fa-cog"></i>
                        ConfiguraÃ§Ãµes
                    </a>
                </li>
            </ul>
        </div>

        <!-- ConteÃºdo Principal -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1 id="pageTitle">Dashboard</h1>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <span id="userName">Administrador</span>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        Sair
                    </button>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboard" class="content-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon empresas">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="stat-value" id="totalEmpresas">0</div>
                        <div class="stat-label">Total de Empresas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon receita">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-value" id="receitaMensal">R$ 0</div>
                        <div class="stat-label">Receita Mensal</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon pendentes">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value" id="pagamentosPendentes">0</div>
                        <div class="stat-label">Pagamentos Pendentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon usuarios">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="usuariosAtivos">0</div>
                        <div class="stat-label">UsuÃ¡rios Ativos</div>
                    </div>
                </div>

                <div class="content-section active">
                    <div class="section-header">
                        <h2 class="section-title">Atividade Recente</h2>
                    </div>
                    <div id="atividadeRecente">
                        <p>Carregando atividades...</p>
                    </div>
                </div>
            </div>

            <!-- Empresas -->
            <div id="empresas" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">GestÃ£o de Empresas</h2>
                    <button class="btn" onclick="openModal('empresaModal')">
                        <i class="fas fa-plus"></i>
                        Nova Empresa
                    </button>
                </div>

                <div class="search-filter">
                    <input type="text" class="search-input" id="searchEmpresas" placeholder="Buscar por nome ou CNPJ...">
                    <select class="filter-select" id="filterStatus">
                        <option value="">Todos os Status</option>
                        <option value="ativo">Ativo</option>
                        <option value="inativo">Inativo</option>
                        <option value="pendente">Pendente</option>
                    </select>
                </div>

                <div id="empresasLoading" class="loading">
                    <div class="spinner"></div>
                    <p>Carregando empresas...</p>
                </div>

                <table class="table" id="empresasTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>Empresa</th>
                            <th>CNPJ</th>
                            <th>Plano</th>
                            <th>FuncionÃ¡rios</th>
                            <th>Status</th>
                            <th>AÃ§Ãµes</th>
                        </tr>
                    </thead>
                    <tbody id="empresasTableBody">
                    </tbody>
                </table>
            </div>

            <!-- Financeiro -->
            <div id="financeiro" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Controle Financeiro</h2>
                    <button class="btn" onclick="gerarCobranca()">
                        <i class="fas fa-credit-card"></i>
                        Gerar CobranÃ§a
                    </button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon receita">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-value" id="totalRecebido">R$ 0</div>
                        <div class="stat-label">Total Recebido</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon pendentes">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value" id="totalPendente">R$ 0</div>
                        <div class="stat-label">Total Pendente</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon empresas">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-value" id="totalAtrasado">R$ 0</div>
                        <div class="stat-label">Total em Atraso</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon usuarios">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="stat-value" id="mrr">R$ 0</div>
                        <div class="stat-label">MRR</div>
                    </div>
                </div>

                <div class="search-filter">
                    <select class="filter-select" id="filterPagamentos">
                        <option value="">Todos os Pagamentos</option>
                        <option value="pago">Pago</option>
                        <option value="pendente">Pendente</option>
                        <option value="atrasado">Atrasado</option>
                    </select>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Empresa</th>
                            <th>Plano</th>
                            <th>Valor</th>
                            <th>Vencimento</th>
                            <th>Status</th>
                            <th>AÃ§Ãµes</th>
                        </tr>
                    </thead>
                    <tbody id="pagamentosTableBody">
                    </tbody>
                </table>
            </div>

            <!-- UsuÃ¡rios -->
            <div id="usuarios" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">GestÃ£o de UsuÃ¡rios</h2>
                    <button class="btn" onclick="openModal('usuarioModal')">
                        <i class="fas fa-user-plus"></i>
                        Novo UsuÃ¡rio
                    </button>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Empresa</th>
                            <th>Ãltimo Acesso</th>
                            <th>Status</th>
                            <th>AÃ§Ãµes</th>
                        </tr>
                    </thead>
                    <tbody id="usuariosTableBody">
                    </tbody>
                </table>
            </div>

            <!-- RelatÃ³rios -->
            <div id="relatorios" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">RelatÃ³rios</h2>
                    <button class="btn" onclick="exportarRelatorio()">
                        <i class="fas fa-download"></i>
                        Exportar
                    </button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon empresas">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-value">+15%</div>
                        <div class="stat-label">Crescimento Mensal</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon receita">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-value">98%</div>
                        <div class="stat-label">Taxa de Pagamento</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon pendentes">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-value">85%</div>
                        <div class="stat-label">RetenÃ§Ã£o de Clientes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon usuarios">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-value">4.8</div>
                        <div class="stat-label">SatisfaÃ§Ã£o MÃ©dia</div>
                    </div>
                </div>
            </div>

            <!-- ConfiguraÃ§Ãµes -->
            <div id="configuracoes" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">ConfiguraÃ§Ãµes</h2>
                    <button class="btn btn-success" onclick="salvarConfiguracoes()">
                        <i class="fas fa-save"></i>
                        Salvar
                    </button>
                </div>

                <div class="payment-section">
                    <h3>IntegraÃ§Ã£o Mercado Pago</h3>
                    <div class="form-group">
                        <label class="form-label">Public Key:</label>
                        <input type="text" class="form-input" id="mpPublicKey" value="APP_USR_dfe5e1ec-cc38-49ca-9716-d81df2c8135f" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Access Token:</label>
                        <input type="password" class="form-input" id="mpAccessToken" value="APP_USR_4347381560839596-091702-424046961650c2014644cf00200540eb-276703097" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Webhook URL:</label>
                        <input type="text" class="form-input" value="https://pontofacil.app.br/webhook/mercadopago" readonly>
                    </div>
                </div>

                <div class="payment-section">
                    <h3>Planos e PreÃ§os</h3>
                    <div class="plan-card">
                        <div class="plan-name">Plano BÃ¡sico</div>
                        <div class="plan-price">R$ 29,90/mÃªs</div>
                        <ul class="plan-features">
                            <li>AtÃ© 10 funcionÃ¡rios</li>
                            <li>RelatÃ³rios bÃ¡sicos</li>
                            <li>Suporte por email</li>
                        </ul>
                    </div>
                    <div class="plan-card">
                        <div class="plan-name">Plano Profissional</div>
                        <div class="plan-price">R$ 59,90/mÃªs</div>
                        <ul class="plan-features">
                            <li>AtÃ© 50 funcionÃ¡rios</li>
                            <li>RelatÃ³rios avanÃ§ados</li>
                            <li>Suporte prioritÃ¡rio</li>
                            <li>IntegraÃ§Ã£o API</li>
                        </ul>
                    </div>
                    <div class="plan-card">
                        <div class="plan-name">Plano Empresarial</div>
                        <div class="plan-price">R$ 99,90/mÃªs</div>
                        <ul class="plan-features">
                            <li>FuncionÃ¡rios ilimitados</li>
                            <li>RelatÃ³rios personalizados</li>
                            <li>Suporte telefÃ´nico</li>
                            <li>MÃºltiplas filiais</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Empresa -->
    <div id="empresaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="empresaModalTitle">Nova Empresa</h3>
                <button class="close-btn" onclick="closeModal('empresaModal')">&times;</button>
            </div>
            
            <div id="empresaAlert" class="alert"></div>
            
            <form id="empresaForm">
                <div class="form-group">
                    <label class="form-label">Nome da Empresa:</label>
                    <input type="text" id="empresaNome" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">CNPJ:</label>
                    <input type="text" id="empresaCnpj" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email:</label>
                    <input type="email" id="empresaEmail" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Telefone:</label>
                    <input type="tel" id="empresaTelefone" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Plano:</label>
                    <select id="empresaPlano" class="form-select" required>
                        <option value="">Selecione um plano</option>
                        <option value="basico">BÃ¡sico - R$ 29,90/mÃªs</option>
                        <option value="profissional">Profissional - R$ 59,90/mÃªs</option>
                        <option value="empresarial">Empresarial - R$ 99,90/mÃªs</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Status:</label>
                    <select id="empresaStatus" class="form-select" required>
                        <option value="ativo">Ativo</option>
                        <option value="inativo">Inativo</option>
                        <option value="pendente">Pendente</option>
                    </select>
                </div>
                <button type="submit" class="btn" style="width: 100%;">
                    <i class="fas fa-save"></i>
                    Salvar Empresa
                </button>
            </form>
            
            <div id="empresaLoading" class="loading">
                <div class="spinner"></div>
                <p>Salvando empresa...</p>
            </div>
        </div>
    </div>

    <!-- Modal UsuÃ¡rio -->
    <div id="usuarioModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Novo UsuÃ¡rio</h3>
                <button class="close-btn" onclick="closeModal('usuarioModal')">&times;</button>
            </div>
            
            <form id="usuarioForm">
                <div class="form-group">
                    <label class="form-label">Nome:</label>
                    <input type="text" id="usuarioNome" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email:</label>
                    <input type="email" id="usuarioEmail" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Empresa:</label>
                    <select id="usuarioEmpresa" class="form-select" required>
                        <option value="">Selecione uma empresa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Senha TemporÃ¡ria:</label>
                    <input type="password" id="usuarioSenha" class="form-input" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">
                    <i class="fas fa-user-plus"></i>
                    Criar UsuÃ¡rio
                </button>
            </form>
        </div>
    </div>

    <script>
        // ConfiguraÃ§Ã£o Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBnSGgBLjCJOGOJqPGqNOGKJOGKJOGKJOG",
            authDomain: "pontofacil-f4766.firebaseapp.com",
            projectId: "pontofacil-f4766",
            storageBucket: "pontofacil-f4766.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdefghijklmnop"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ConfiguraÃ§Ã£o Mercado Pago
        const mp = new MercadoPago('APP_USR_dfe5e1ec-cc38-49ca-9716-d81df2c8135f');

        // VariÃ¡veis globais
        let currentUser = null;
        let empresas = [];
        let pagamentos = [];
        let editingEmpresaId = null;

        // Verificar autenticaÃ§Ã£o
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                showMainPanel();
                loadDashboardData();
            } else {
                showLoginScreen();
            }
        });

        // Mostrar tela de login
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainPanel').style.display = 'none';
        }

        // Mostrar painel principal
        function showMainPanel() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainPanel').style.display = 'flex';
            
            // Atualizar informaÃ§Ãµes do usuÃ¡rio
            const userName = currentUser.email.split('@')[0];
            document.getElementById('userName').textContent = userName;
            document.getElementById('userAvatar').textContent = userName.charAt(0).toUpperCase();
        }

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            showLoading('loginLoading', true);
            hideAlert('loginAlert');
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                showAlert('loginAlert', 'Erro ao fazer login: ' + error.message, 'error');
            } finally {
                showLoading('loginLoading', false);
            }
        });

        // Logout
        function logout() {
            auth.signOut();
        }

        // NavegaÃ§Ã£o
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Remover classe active de todos os links
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                
                // Adicionar classe active ao link clicado
                link.classList.add('active');
                
                // Mostrar seÃ§Ã£o correspondente
                const section = link.dataset.section;
                showSection(section);
            });
        });

        // Mostrar seÃ§Ã£o
        function showSection(sectionName) {
            // Esconder todas as seÃ§Ãµes
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar seÃ§Ã£o selecionada
            document.getElementById(sectionName).classList.add('active');
            
            // Atualizar tÃ­tulo da pÃ¡gina
            const titles = {
                dashboard: 'Dashboard',
                empresas: 'GestÃ£o de Empresas',
                financeiro: 'Controle Financeiro',
                usuarios: 'GestÃ£o de UsuÃ¡rios',
                relatorios: 'RelatÃ³rios',
                configuracoes: 'ConfiguraÃ§Ãµes'
            };
            
            document.getElementById('pageTitle').textContent = titles[sectionName] || 'Dashboard';
            
            // Carregar dados especÃ­ficos da seÃ§Ã£o
            if (sectionName === 'empresas') {
                loadEmpresas();
            } else if (sectionName === 'financeiro') {
                loadPagamentos();
            } else if (sectionName === 'usuarios') {
                loadUsuarios();
            }
        }

        // Carregar dados do dashboard
        async function loadDashboardData() {
            try {
                // Carregar empresas
                const empresasSnapshot = await db.collection('admin_empresas').get();
                const totalEmpresas = empresasSnapshot.size;
                
                // Calcular mÃ©tricas
                let receitaMensal = 0;
                let pagamentosPendentes = 0;
                let usuariosAtivos = 0;
                
                empresasSnapshot.forEach(doc => {
                    const empresa = doc.data();
                    if (empresa.status === 'ativo') {
                        usuariosAtivos++;
                        const precos = {
                            basico: 29.90,
                            profissional: 59.90,
                            empresarial: 99.90
                        };
                        receitaMensal += precos[empresa.plano] || 0;
                    } else if (empresa.status === 'pendente') {
                        pagamentosPendentes++;
                    }
                });
                
                // Atualizar interface
                document.getElementById('totalEmpresas').textContent = totalEmpresas;
                document.getElementById('receitaMensal').textContent = `R$ ${receitaMensal.toFixed(2)}`;
                document.getElementById('pagamentosPendentes').textContent = pagamentosPendentes;
                document.getElementById('usuariosAtivos').textContent = usuariosAtivos;
                
                // Carregar atividade recente
                loadAtividadeRecente();
                
            } catch (error) {
                console.error('Erro ao carregar dados do dashboard:', error);
            }
        }

        // Carregar atividade recente
        function loadAtividadeRecente() {
            const atividades = [
                { tipo: 'empresa', texto: 'Nova empresa "Tech Solutions" cadastrada', tempo: '2 horas atrÃ¡s' },
                { tipo: 'pagamento', texto: 'Pagamento recebido de "Loja Maria"', tempo: '4 horas atrÃ¡s' },
                { tipo: 'usuario', texto: 'Novo usuÃ¡rio criado para "Empresa ABC"', tempo: '1 dia atrÃ¡s' },
                { tipo: 'sistema', texto: 'Backup automÃ¡tico realizado', tempo: '2 dias atrÃ¡s' }
            ];
            
            const html = atividades.map(atividade => `
                <div style="padding: 1rem; border-left: 3px solid #667eea; margin-bottom: 1rem; background: #f8f9fa;">
                    <strong>${atividade.texto}</strong>
                    <div style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">${atividade.tempo}</div>
                </div>
            `).join('');
            
            document.getElementById('atividadeRecente').innerHTML = html;
        }

        // Carregar empresas
        async function loadEmpresas() {
            showLoading('empresasLoading', true);
            document.getElementById('empresasTable').style.display = 'none';
            
            try {
                const snapshot = await db.collection('admin_empresas').orderBy('dataCadastro', 'desc').get();
                empresas = [];
                
                snapshot.forEach(doc => {
                    empresas.push({ id: doc.id, ...doc.data() });
                });
                
                renderEmpresas();
                
            } catch (error) {
                console.error('Erro ao carregar empresas:', error);
            } finally {
                showLoading('empresasLoading', false);
                document.getElementById('empresasTable').style.display = 'table';
            }
        }

        // Renderizar empresas
        function renderEmpresas() {
            const tbody = document.getElementById('empresasTableBody');
            
            if (empresas.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">Nenhuma empresa cadastrada</td></tr>';
                return;
            }
            
            const html = empresas.map(empresa => `
                <tr>
                    <td>
                        <strong>${empresa.nome}</strong><br>
                        <small style="color: #666;">${empresa.email}</small>
                    </td>
                    <td>${empresa.cnpj}</td>
                    <td>
                        <span style="text-transform: capitalize;">${empresa.plano}</span><br>
                        <small style="color: #666;">R$ ${getPlanoPreco(empresa.plano)}/mÃªs</small>
                    </td>
                    <td>${empresa.funcionarios || 0}</td>
                    <td>
                        <span class="status-badge status-${empresa.status}">
                            ${empresa.status.charAt(0).toUpperCase() + empresa.status.slice(1)}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm" onclick="editEmpresa('${empresa.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEmpresa('${empresa.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn btn-sm btn-success" onclick="gerarCobrancaEmpresa('${empresa.id}')">
                                <i class="fas fa-credit-card"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            tbody.innerHTML = html;
        }

        // Obter preÃ§o do plano
        function getPlanoPreco(plano) {
            const precos = {
                basico: '29,90',
                profissional: '59,90',
                empresarial: '99,90'
            };
            return precos[plano] || '0,00';
        }

        // Buscar empresas
        document.getElementById('searchEmpresas').addEventListener('input', (e) => {
            const search = e.target.value.toLowerCase();
            const filtered = empresas.filter(empresa => 
                empresa.nome.toLowerCase().includes(search) ||
                empresa.cnpj.includes(search)
            );
            renderEmpresasFiltered(filtered);
        });

        // Filtrar por status
        document.getElementById('filterStatus').addEventListener('change', (e) => {
            const status = e.target.value;
            const filtered = status ? empresas.filter(empresa => empresa.status === status) : empresas;
            renderEmpresasFiltered(filtered);
        });

        // Renderizar empresas filtradas
        function renderEmpresasFiltered(filtered) {
            const tbody = document.getElementById('empresasTableBody');
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">Nenhuma empresa encontrada</td></tr>';
                return;
            }
            
            const html = filtered.map(empresa => `
                <tr>
                    <td>
                        <strong>${empresa.nome}</strong><br>
                        <small style="color: #666;">${empresa.email}</small>
                    </td>
                    <td>${empresa.cnpj}</td>
                    <td>
                        <span style="text-transform: capitalize;">${empresa.plano}</span><br>
                        <small style="color: #666;">R$ ${getPlanoPreco(empresa.plano)}/mÃªs</small>
                    </td>
                    <td>${empresa.funcionarios || 0}</td>
                    <td>
                        <span class="status-badge status-${empresa.status}">
                            ${empresa.status.charAt(0).toUpperCase() + empresa.status.slice(1)}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm" onclick="editEmpresa('${empresa.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEmpresa('${empresa.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn btn-sm btn-success" onclick="gerarCobrancaEmpresa('${empresa.id}')">
                                <i class="fas fa-credit-card"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            tbody.innerHTML = html;
        }

        // FormulÃ¡rio de empresa
        document.getElementById('empresaForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                nome: document.getElementById('empresaNome').value,
                cnpj: document.getElementById('empresaCnpj').value,
                email: document.getElementById('empresaEmail').value,
                telefone: document.getElementById('empresaTelefone').value,
                plano: document.getElementById('empresaPlano').value,
                status: document.getElementById('empresaStatus').value,
                funcionarios: 0,
                dataCadastro: firebase.firestore.FieldValue.serverTimestamp(),
                dataAtualizacao: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            showLoading('empresaLoading', true);
            hideAlert('empresaAlert');
            
            try {
                if (editingEmpresaId) {
                    // Editar empresa existente
                    await db.collection('admin_empresas').doc(editingEmpresaId).update(formData);
                    showAlert('empresaAlert', 'Empresa atualizada com sucesso!', 'success');
                } else {
                    // Criar nova empresa
                    await db.collection('admin_empresas').add(formData);
                    showAlert('empresaAlert', 'Empresa cadastrada com sucesso!', 'success');
                }
                
                // Limpar formulÃ¡rio
                document.getElementById('empresaForm').reset();
                editingEmpresaId = null;
                
                // Recarregar lista
                setTimeout(() => {
                    closeModal('empresaModal');
                    loadEmpresas();
                    loadDashboardData();
                }, 1500);
                
            } catch (error) {
                showAlert('empresaAlert', 'Erro ao salvar empresa: ' + error.message, 'error');
            } finally {
                showLoading('empresaLoading', false);
            }
        });

        // Editar empresa
        function editEmpresa(id) {
            const empresa = empresas.find(e => e.id === id);
            if (!empresa) return;
            
            editingEmpresaId = id;
            
            document.getElementById('empresaNome').value = empresa.nome;
            document.getElementById('empresaCnpj').value = empresa.cnpj;
            document.getElementById('empresaEmail').value = empresa.email;
            document.getElementById('empresaTelefone').value = empresa.telefone;
            document.getElementById('empresaPlano').value = empresa.plano;
            document.getElementById('empresaStatus').value = empresa.status;
            
            document.getElementById('empresaModalTitle').textContent = 'Editar Empresa';
            openModal('empresaModal');
        }

        // Excluir empresa
        async function deleteEmpresa(id) {
            if (!confirm('Tem certeza que deseja excluir esta empresa?')) return;
            
            try {
                await db.collection('admin_empresas').doc(id).delete();
                loadEmpresas();
                loadDashboardData();
            } catch (error) {
                alert('Erro ao excluir empresa: ' + error.message);
            }
        }

        // Gerar cobranÃ§a para empresa especÃ­fica
        async function gerarCobrancaEmpresa(empresaId) {
            const empresa = empresas.find(e => e.id === empresaId);
            if (!empresa) return;
            
            const precos = {
                basico: 29.90,
                profissional: 59.90,
                empresarial: 99.90
            };
            
            const valor = precos[empresa.plano];
            
            try {
                // Criar preferÃªncia de pagamento no Mercado Pago
                const preference = {
                    items: [{
                        title: `PontoFÃ¡cil - Plano ${empresa.plano.charAt(0).toUpperCase() + empresa.plano.slice(1)}`,
                        quantity: 1,
                        unit_price: valor,
                        currency_id: 'BRL'
                    }],
                    payer: {
                        email: empresa.email,
                        name: empresa.nome
                    },
                    external_reference: empresaId,
                    notification_url: 'https://pontofacil.app.br/webhook/mercadopago',
                    back_urls: {
                        success: 'https://pontofacil.app.br/pagamento/sucesso',
                        failure: 'https://pontofacil.app.br/pagamento/erro',
                        pending: 'https://pontofacil.app.br/pagamento/pendente'
                    }
                };
                
                // Aqui vocÃª faria a chamada para a API do Mercado Pago
                // Por enquanto, vamos simular
                alert(`CobranÃ§a gerada para ${empresa.nome} - Valor: R$ ${valor.toFixed(2)}`);
                
            } catch (error) {
                alert('Erro ao gerar cobranÃ§a: ' + error.message);
            }
        }

        // Carregar pagamentos
        function loadPagamentos() {
            // Simular dados de pagamentos
            pagamentos = empresas.map(empresa => {
                const precos = {
                    basico: 29.90,
                    profissional: 59.90,
                    empresarial: 99.90
                };
                
                const valor = precos[empresa.plano] || 0;
                const vencimento = new Date();
                vencimento.setDate(vencimento.getDate() + Math.floor(Math.random() * 30));
                
                let status = 'pago';
                if (empresa.status === 'pendente') status = 'pendente';
                if (Math.random() > 0.8) status = 'atrasado';
                
                return {
                    id: empresa.id,
                    empresa: empresa.nome,
                    plano: empresa.plano,
                    valor: valor,
                    vencimento: vencimento,
                    status: status
                };
            });
            
            renderPagamentos();
            updateFinanceiroStats();
        }

        // Renderizar pagamentos
        function renderPagamentos() {
            const tbody = document.getElementById('pagamentosTableBody');
            
            if (pagamentos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">Nenhum pagamento encontrado</td></tr>';
                return;
            }
            
            const html = pagamentos.map(pagamento => `
                <tr>
                    <td><strong>${pagamento.empresa}</strong></td>
                    <td style="text-transform: capitalize;">${pagamento.plano}</td>
                    <td>R$ ${pagamento.valor.toFixed(2)}</td>
                    <td>${pagamento.vencimento.toLocaleDateString('pt-BR')}</td>
                    <td>
                        <span class="status-badge status-${pagamento.status}">
                            ${pagamento.status.charAt(0).toUpperCase() + pagamento.status.slice(1)}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-success" onclick="marcarComoPago('${pagamento.id}')">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-sm" onclick="enviarLembrete('${pagamento.id}')">
                                <i class="fas fa-envelope"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            tbody.innerHTML = html;
        }

        // Atualizar estatÃ­sticas financeiras
        function updateFinanceiroStats() {
            let totalRecebido = 0;
            let totalPendente = 0;
            let totalAtrasado = 0;
            let mrr = 0;
            
            pagamentos.forEach(pagamento => {
                if (pagamento.status === 'pago') {
                    totalRecebido += pagamento.valor;
                    mrr += pagamento.valor;
                } else if (pagamento.status === 'pendente') {
                    totalPendente += pagamento.valor;
                } else if (pagamento.status === 'atrasado') {
                    totalAtrasado += pagamento.valor;
                }
            });
            
            document.getElementById('totalRecebido').textContent = `R$ ${totalRecebido.toFixed(2)}`;
            document.getElementById('totalPendente').textContent = `R$ ${totalPendente.toFixed(2)}`;
            document.getElementById('totalAtrasado').textContent = `R$ ${totalAtrasado.toFixed(2)}`;
            document.getElementById('mrr').textContent = `R$ ${mrr.toFixed(2)}`;
        }

        // Marcar como pago
        function marcarComoPago(id) {
            const pagamento = pagamentos.find(p => p.id === id);
            if (pagamento) {
                pagamento.status = 'pago';
                renderPagamentos();
                updateFinanceiroStats();
            }
        }

        // Enviar lembrete
        function enviarLembrete(id) {
            const pagamento = pagamentos.find(p => p.id === id);
            if (pagamento) {
                alert(`Lembrete enviado para ${pagamento.empresa}`);
            }
        }

        // Carregar usuÃ¡rios
        function loadUsuarios() {
            // Simular dados de usuÃ¡rios
            const usuarios = empresas.map(empresa => ({
                id: empresa.id,
                nome: empresa.nome.split(' ')[0] + ' Admin',
                email: empresa.email,
                empresa: empresa.nome,
                ultimoAcesso: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000),
                status: empresa.status
            }));
            
            const tbody = document.getElementById('usuariosTableBody');
            
            if (usuarios.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">Nenhum usuÃ¡rio encontrado</td></tr>';
                return;
            }
            
            const html = usuarios.map(usuario => `
                <tr>
                    <td><strong>${usuario.nome}</strong></td>
                    <td>${usuario.email}</td>
                    <td>${usuario.empresa}</td>
                    <td>${usuario.ultimoAcesso.toLocaleDateString('pt-BR')}</td>
                    <td>
                        <span class="status-badge status-${usuario.status}">
                            ${usuario.status.charAt(0).toUpperCase() + usuario.status.slice(1)}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm" onclick="editUsuario('${usuario.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteUsuario('${usuario.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            tbody.innerHTML = html;
        }

        // Gerar cobranÃ§a geral
        function gerarCobranca() {
            alert('Gerando cobranÃ§as para todas as empresas ativas...');
        }

        // Exportar relatÃ³rio
        function exportarRelatorio() {
            alert('Exportando relatÃ³rio...');
        }

        // Salvar configuraÃ§Ãµes
        function salvarConfiguracoes() {
            alert('ConfiguraÃ§Ãµes salvas com sucesso!');
        }

        // FunÃ§Ãµes de modal
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            
            // Limpar formulÃ¡rio se for modal de empresa
            if (modalId === 'empresaModal' && !editingEmpresaId) {
                document.getElementById('empresaForm').reset();
                document.getElementById('empresaModalTitle').textContent = 'Nova Empresa';
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            editingEmpresaId = null;
            hideAlert('empresaAlert');
        }

        // FunÃ§Ãµes utilitÃ¡rias
        function showLoading(elementId, show) {
            const element = document.getElementById(elementId);
            if (show) {
                element.classList.add('active');
            } else {
                element.classList.remove('active');
            }
        }

        function showAlert(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `alert alert-${type} active`;
        }

        function hideAlert(elementId) {
            const element = document.getElementById(elementId);
            element.classList.remove('active');
        }

        // Fechar modal ao clicar fora
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                    editingEmpresaId = null;
                }
            });
        });

        // MÃ¡scara para CNPJ
        document.getElementById('empresaCnpj').addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/^(\d{2})(\d)/, '$1.$2');
            value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
            value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
            value = value.replace(/(\d{4})(\d)/, '$1-$2');
            e.target.value = value;
        });

        // InicializaÃ§Ã£o
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar se jÃ¡ estÃ¡ logado
            const user = auth.currentUser;
            if (user) {
                showMainPanel();
                loadDashboardData();
            } else {
                showLoginScreen();
            }
        });
    </script>
</body>
</html>
